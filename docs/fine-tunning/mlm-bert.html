
<!DOCTYPE html>


<html lang="zh-CN" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GESLLLJC6M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-GESLLLJC6M');
    </script>
    
    <title>ä½¿ç”¨MLMå¾®è°ƒBertæ¨¡å‹ &#8212; äººå·¥æ™ºèƒ½å®è·µ 0.7 æ–‡æ¡£</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=be9b6ff4" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=447f2b7d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'fine-tunning/mlm-bert';</script>
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" />
    <link rel="next" title="ç»ƒä¹ ï¼šä½¿ç”¨è‡ªç›‘ç£å­¦ä¹ å¾®è°ƒPhi4-mini" href="ft-ph4-self.html" />
    <link rel="prev" title="å¾®è°ƒè¡¨ç¤ºå‹å¤§æ¨¡å‹" href="ft-rep-models.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="zh-CN"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">äººå·¥æ™ºèƒ½å®è·µ 0.7 æ–‡æ¡£</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="æœç´¢" aria-label="æœç´¢" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">æœç´¢</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">è¯¾ç¨‹ç®€ä»‹</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../1-Intro/intro.html">è¯¾ç¨‹å¤§çº²</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-Intro/resources.html">èµ„æº</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-Intro/terms.html">æœ¯è¯­</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">å¤§æ¨¡å‹åŸºç¡€</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../2-Basics/setup.html">ç¯å¢ƒå‡†å¤‡</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2-Basics/llm-basics.html">LLM åŸºç¡€</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">åŸºäºTransformerçš„è‡ªç„¶è¯­è¨€å¤„ç†</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3-Practice/nlp-tasks.html">NLP ä»»åŠ¡</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-Practice/transformer-nlp.html">åŸºäºHF Transformerçš„NLPå®è·µ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-Practice/classification.html">æ–‡æœ¬åˆ†ç±»</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-Practice/clusttering.html">æ–‡æ¡£èšç±»</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">è¯­è¨€å­¦åŸºç¡€</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../4-Linguistics/linguistics-llm.html">å¤§è¯­è¨€æ¨¡å‹ä¸è¯­è¨€å­¦</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Linguistics/llm-metrics.html">å¸¸è§å¤§æ¨¡å‹è¯„ä»·æŒ‡æ ‡</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Linguistics/translation-metrics.html">è¯‘æ–‡è´¨é‡è¯„ä»·æ–¹æ³•</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Linguistics/linguistics-intro.html">è¯­è¨€å­¦ç®€ä»‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Linguistics/applied-linguistics.html">åº”ç”¨è¯­è¨€å­¦</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">è¯¾ç¨‹å®è·µé¡¹ç›®</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../5-Projects/projects.html">è¯¾ç¨‹å®è·µé¡¹ç›®è¦æ±‚</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-Projects/evaluating-llms.html">å¤§æ¨¡å‹çš„è¯„ä¼°ä¸é€‰æ‹©</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-Projects/evaluate-case.html">è¯„ä»·æ¨¡å‹ç¿»è¯‘èƒ½åŠ›</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">æç¤ºè¯</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../6-Prompts/prompts-intro.html">æç¤ºè¯å¯¼è®º</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-Prompts/prompts-examples.html">æç¤ºè¯æ¡ˆä¾‹åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-Prompts/langchain.html">åŸºäºLangchainçš„æç¤ºè¯å¼€å‘å®è·µ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-Prompts/good-examples.html">æç¤ºè¯æ¡ˆä¾‹åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-Prompts/jail-break.html">æç¤ºè¯è¶Šç‹±</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">å¾®è°ƒ</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ft-gen-models.html">å¾®è°ƒç”Ÿæˆå¼å¤§æ¨¡å‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft-phi4.html">SFT å¾®è°ƒ Phi-4</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft-rep-models.html">å¾®è°ƒè¡¨ç¤ºå‹å¤§æ¨¡å‹</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">ä½¿ç”¨MLMå¾®è°ƒBertæ¨¡å‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft-ph4-self.html">ç»ƒä¹ ï¼šä½¿ç”¨è‡ªç›‘ç£å­¦ä¹ å¾®è°ƒPhi4-mini</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft-rl.html">åŸºäºäººç±»åé¦ˆå¾®è°ƒå¤§æ¨¡å‹ï¼ˆRLHF + DPOï¼‰</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">æ™ºèƒ½ä½“</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Agents/agents.html">æ™ºèƒ½ä½“æ¦‚è¿°</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Agents/LangGraph.html">åŸºäºLangGraphçš„æ™ºèƒ½ä½“å¼€å‘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Agents/mcp.html">æ¨¡å‹ä¸Šä¸‹æ–‡åè®® MCP</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">å‚è€ƒç­”æ¡ˆ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../answers/transformer-practice-answers.html">åŸºäºHF Transformerçš„NLPå®è·µçš„ç»ƒä¹ ç­”æ¡ˆ</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="ä¸‹è½½æ­¤é¡µé¢">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/fine-tunning/mlm-bert.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="ä¸‹è½½æºæ–‡ä»¶"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="åˆ—å°æˆ PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="å…¨å±æ¨¡å¼"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="æœç´¢" aria-label="æœç´¢" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ä½¿ç”¨MLMå¾®è°ƒBertæ¨¡å‹</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> ç›®å½• </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#masked-language-model-mlm">æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked Language Modelï¼ŒMLMï¼‰</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">ç¤ºä¾‹æ•°æ®</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">ç¤ºä¾‹ä»£ç </a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bert-mlm">ä½¿ç”¨å¾®è½¯æ–‡æ¡£æ–‡æœ¬å¾®è°ƒBert (MLM)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-1">Cell 1: å®‰è£…ä¾èµ–</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-2-microsoftdocs-azure-docs">Cell 2: å…‹éš† MicrosoftDocs/azure-docs ä»“åº“</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-3-markdown">Cell 3: å¤„ç† Markdown æ–‡ä»¶</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-4-hugging-face">Cell 4: ä»å¤„ç†åçš„æ•°æ®åˆ›å»º Hugging Face æ•°æ®é›†</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-5-bert">Cell 5: åŠ è½½ bert æ¨¡å‹å’Œåˆ†è¯å™¨ï¼Œå¹¶å¯¹æ•°æ®é›†è¿›è¡Œåˆ†è¯</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-6-mlm">Cell 6: å‡†å¤‡ç”¨äº MLM çš„æ•°æ®æ”¶é›†å™¨</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-7-trainer">Cell 7: è®¾ç½®è®­ç»ƒå‚æ•°å¹¶åˆå§‹åŒ– Trainer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-8-mlm">Cell 8: ä½¿ç”¨ MLM ç›®æ ‡å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒ</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-9">Cell 9: ä¿å­˜å¾®è°ƒåçš„æ¨¡å‹å’Œåˆ†è¯å™¨</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">å‡†å¤‡æ•°æ®</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jsongoogle-drive">å°†æ•°æ®è½¬ä¸ºjsonå­˜å…¥Google Drive</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#json-docs-texts">ä»ç›®æ ‡è·¯å¾„ä¸­çš„ JSON æ–‡ä»¶ä¸­åŠ è½½ docs_texts</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nsp">ä¸‹ä¸€å¥é¢„æµ‹ï¼ˆNSPï¼‰</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">å‚è€ƒèµ„æ–™</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="mlmbert">
<h1>ä½¿ç”¨MLMå¾®è°ƒBertæ¨¡å‹<a class="headerlink" href="#mlmbert" title="Link to this heading">#</a></h1>
<p>ä¸‹æ–¹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Hugging Face Transformers åº“å¯¹ Bert æ¨¡å‹è¿›è¡Œ MLM å¾®è°ƒï¼Œå¹¶ä¸”æ¼”ç¤ºäº†å¦‚ä½•å…‹éš†å¹¶å¤„ç† MicrosoftDocs/azure-docs ä»“åº“ä¸­çš„æ–‡æ¡£æ•°æ®ä½œä¸ºè®­ç»ƒæ•°æ®ã€‚</p>
<p>Google Colab Notebook åœ°å€ï¼š <a class="reference external" href="https://colab.research.google.com/drive/1HAnmGSR-tCeLtfRrFaCFzpD65ABWJY2n?usp=sharing"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<section id="masked-language-model-mlm">
<h2>æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked Language Modelï¼ŒMLMï¼‰<a class="headerlink" href="#masked-language-model-mlm" title="Link to this heading">#</a></h2>
<p>å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œè¾“å…¥æ–‡æœ¬ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">[MASK]</span></code> æ ‡è®°é€šå¸¸ç”±å¾®è°ƒç¨‹åºè‡ªåŠ¨ç”Ÿæˆã€‚å…·ä½“è€Œè¨€ï¼Œå¾®è°ƒç¨‹åºä¼šæŒ‰ç…§é¢„è®¾çš„ç­–ç•¥ï¼Œå¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œéšæœºé€‰æ‹©éƒ¨åˆ†è¯æ±‡è¿›è¡Œæ©ç æ“ä½œï¼Œä»¥è®­ç»ƒæ¨¡å‹é¢„æµ‹è¢«æ©ç çš„è¯æ±‡ã€‚</p>
<p><strong>æ©ç ç­–ç•¥</strong></p>
<ol class="arabic simple">
<li><p><strong>æ©ç æ¯”ä¾‹</strong>ï¼šé€šå¸¸é€‰æ‹©è¾“å…¥åºåˆ—ä¸­çº¦15%çš„è¯æ±‡è¿›è¡Œæ©ç ã€‚</p></li>
<li><p><strong>æ©ç æ–¹å¼</strong>ï¼š</p>
<ul class="simple">
<li><p><strong>80%</strong> çš„æƒ…å†µä¸‹ï¼Œå°†é€‰å®šçš„è¯æ›¿æ¢ä¸º <code class="docutils literal notranslate"><span class="pre">[MASK]</span></code> æ ‡è®°ã€‚</p></li>
<li><p><strong>10%</strong> çš„æƒ…å†µä¸‹ï¼Œä¿æŒé€‰å®šçš„è¯ä¸å˜ã€‚</p></li>
<li><p><strong>10%</strong> çš„æƒ…å†µä¸‹ï¼Œå°†é€‰å®šçš„è¯æ›¿æ¢ä¸ºè¯æ±‡è¡¨ä¸­çš„éšæœºè¯ã€‚</p></li>
</ul>
</li>
</ol>
<p>è¿™ç§ç­–ç•¥çš„ç›®çš„æ˜¯ä½¿æ¨¡å‹ä¸ä»…èƒ½å¤Ÿå­¦ä¹ åˆ° <code class="docutils literal notranslate"><span class="pre">[MASK]</span></code> æ ‡è®°çš„ä¸Šä¸‹æ–‡ï¼Œè¿˜èƒ½åœ¨é¢å¯¹æœªè¢«æ©ç çš„è¯æˆ–éšæœºæ›¿æ¢çš„è¯æ—¶ï¼Œå¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œè¿™äº›æ©ç æ“ä½œç”±ç¨‹åºè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚å¼€å‘è€…åªéœ€æä¾›åŸå§‹æ–‡æœ¬æ•°æ®ï¼Œå¾®è°ƒç¨‹åºä¼šæ ¹æ®ä¸Šè¿°ç­–ç•¥è‡ªåŠ¨ç”ŸæˆåŒ…å« <code class="docutils literal notranslate"><span class="pre">[MASK]</span></code> æ ‡è®°çš„è®­ç»ƒæ•°æ®ï¼Œä»¥è®­ç»ƒæ¨¡å‹é¢„æµ‹è¢«æ©ç çš„è¯æ±‡ã€‚</p>
<section id="id1">
<h3>ç¤ºä¾‹æ•°æ®<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Introduction&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Java is one of the most used programming languages, according to Stack Overflow and GitHub. Java Virtual Machine (JVM) offers a mature way to run Java applications efficiently. Azure offers various ways to deploy your Java applications. No matter what types of Java applications you&#39;re running, Azure has a solution. You can choose from batch processes, nanoservices, and microservices, all the way up to Java Enterprise Edition (EE) and Jakarta EE applications. In this module, we look at Java&#39;s powerful features and give an overview of Azure deployment offers. This module is for Java developers and system administrators who have experience with running Java applications. There&#39;s no coding involved in this conceptual module. Learning objectives By the end of this module, you&#39;ll be able to: Differentiate between types of Java applications. Explain the opportunities for Java developers on Azure. Prerequisites Basic development experience in Java or system operating knowledge for Java-based architectures.&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Java at Microsoft&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Developers from around the world learn programming with Java, and it remains one of the most used languages among enterprises. It can help you solve business requirements at all levels. With millions of Java developers worldwide, Java&#39;s success speaks for itself. Java is a strategic language of choice on Azure. We support Java developers on multiple levels to deploy their Java applications. No matter what your architecture looks like, Azure has a solution for you; from monolithic applications to microservices or even serverless applications. Microsoft has a high interest in supporting Java and Java on Azure. Did you know that Microsoft is an official contributor to OpenJDK? Microsoft uses Java in many of its products, like LinkedIn, Yammer, Minecraft, and Surface Duo.&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>ç¤ºä¾‹ä»£ç <a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>åœ¨ä½¿ç”¨ Hugging Face çš„ Transformers åº“è¿›è¡Œ MLM è®­ç»ƒæ—¶ï¼Œå…³é”®åœ¨äºæ•°æ®çš„é¢„å¤„ç†ã€‚è¿™é€šå¸¸<code class="docutils literal notranslate"><span class="pre">DataCollatorForLanguageModeling</span></code> æ¥å®ç°ï¼Œè¯¥ç±»è´Ÿè´£åœ¨è®­ç»ƒæ—¶å¯¹è¾“å…¥æ•°æ®è¿›è¡Œéšæœºæ©ç æ“ä½œã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataCollatorForLanguageModeling</span>

<span class="n">data_collator</span> <span class="o">=</span> <span class="n">DataCollatorForLanguageModeling</span><span class="p">(</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">mlm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># å¯ç”¨æ©ç è¯­è¨€æ¨¡å‹</span>
    <span class="n">mlm_probability</span><span class="o">=</span><span class="mf">0.15</span>  <span class="c1"># è®¾ç½®æ©ç çš„æ¦‚ç‡</span>
<span class="p">)</span>

</pre></div>
</div>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code class="docutils literal notranslate"><span class="pre">mlm=True</span></code> è¡¨ç¤ºå¯ç”¨æ©ç è¯­è¨€æ¨¡å‹ï¼Œ<code class="docutils literal notranslate"><span class="pre">mlm_probability=0.15</span></code> æŒ‡å®šäº†æ©ç çš„æ¦‚ç‡ï¼Œå³éšæœºé€‰æ‹© 15% çš„è¯æ±‡è¿›è¡Œæ©ç å¤„ç†ã€‚ç„¶åï¼Œå°†æ­¤ <code class="docutils literal notranslate"><span class="pre">data_collator</span></code> ä¼ é€’ç»™ <code class="docutils literal notranslate"><span class="pre">Trainer</span></code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Trainer</span><span class="p">,</span> <span class="n">TrainingArguments</span>

<span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./phi-finetuned&quot;</span><span class="p">,</span>
    <span class="n">per_device_train_batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">num_train_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">save_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">save_total_limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
    <span class="n">data_collator</span><span class="o">=</span><span class="n">data_collator</span><span class="p">,</span>  <span class="c1"># ä¼ å…¥æ•°æ®æ•´ç†å™¨</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
<span class="p">)</span>

</pre></div>
</div>
<p>è¿™æ ·ï¼Œ<code class="docutils literal notranslate"><span class="pre">Trainer</span></code> åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨åº”ç”¨æ©ç ç­–ç•¥ã€‚</p>
<p>MLMé€šè¿‡åœ¨è¾“å…¥æ–‡æœ¬ä¸­éšæœºæ©ç›–éƒ¨åˆ†è¯æ±‡ï¼Œå¹¶è¦æ±‚æ¨¡å‹æ ¹æ®ä¸Šä¸‹æ–‡é¢„æµ‹è¿™äº›è¢«æ©ç›–çš„è¯æ±‡æ¥è¿›è¡Œè®­ç»ƒã€‚åœ¨å¾®è°ƒé˜¶æ®µï¼Œä½¿ç”¨ç‰¹å®šé¢†åŸŸçš„æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œæ¨¡å‹ä¼šå­¦ä¹ åˆ°è¯¥é¢†åŸŸçš„è¯­è¨€ç‰¹å¾å’Œç”¨è¯ä¹ æƒ¯ã€‚è¿™ä½¿å¾—æ¨¡å‹åœ¨å¤„ç†è¯¥é¢†åŸŸçš„æ–‡æœ¬æ—¶ï¼Œèƒ½å¤Ÿæ›´å‡†ç¡®åœ°é¢„æµ‹è¯æ±‡ï¼Œæé«˜ç”Ÿæˆæ–‡æœ¬çš„è´¨é‡å’Œç›¸å…³æ€§ã€‚å› æ­¤ï¼ŒMLMå¾®è°ƒé€šè¿‡è®©æ¨¡å‹é€‚åº”ç‰¹å®šé¢†åŸŸçš„è¯­è¨€æ¨¡å¼ï¼Œå¢å¼ºäº†æ¨¡å‹åœ¨è¯¥é¢†åŸŸçš„è¡¨ç°èƒ½åŠ›ã€‚</p>
</section>
</section>
<hr class="docutils" />
<section id="bert-mlm">
<h2>ä½¿ç”¨å¾®è½¯æ–‡æ¡£æ–‡æœ¬å¾®è°ƒBert (MLM)<a class="headerlink" href="#bert-mlm" title="Link to this heading">#</a></h2>
<section id="cell-1">
<h3>Cell 1: å®‰è£…ä¾èµ–<a class="headerlink" href="#cell-1" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">transformers</span> <span class="n">datasets</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-2-microsoftdocs-azure-docs">
<h3>Cell 2: å…‹éš† MicrosoftDocs/azure-docs ä»“åº“<a class="headerlink" href="#cell-2-microsoftdocs-azure-docs" title="Link to this heading">#</a></h3>
<p>è¿™ä¸€æ­¥è€—æ—¶éå¸¸é•¿ï¼Œæœ¬æ¬¡æˆ‘çš„è€—æ—¶çº¦30åˆ†é’Ÿã€‚ä¸ºäº†åç»­æ¼”ç¤ºæ–¹ä¾¿ï¼Œéšæœºåˆ å»äº†å¾ˆå¤šå†…å®¹ï¼Œæœ€ååªä¿ç•™äº†éƒ¨åˆ†æ–‡ä»¶ã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># å…‹éš†ä»“åº“</span>
<span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">MicrosoftDocs</span><span class="o">/</span><span class="n">azure</span><span class="o">-</span><span class="n">docs</span><span class="o">.</span><span class="n">git</span>

<span class="c1"># å¯é€‰ï¼šåˆ—å‡ºéƒ¨åˆ† Markdown æ–‡ä»¶ï¼Œç¡®è®¤ä»“åº“å·²å…‹éš†æˆåŠŸ</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="n">md_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;azure-docs/**/*.md&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;å…±æ‰¾åˆ° </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">md_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> ä¸ª Markdown æ–‡ä»¶ã€‚&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>è¾“å‡ºç»“æœï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cloning</span> <span class="n">into</span> <span class="s1">&#39;azure-docs&#39;</span><span class="o">...</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Enumerating</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">7888510</span><span class="p">,</span> <span class="n">done</span><span class="o">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Counting</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">3279</span><span class="o">/</span><span class="mi">3279</span><span class="p">),</span> <span class="n">done</span><span class="o">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Compressing</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">508</span><span class="o">/</span><span class="mi">508</span><span class="p">),</span> <span class="n">done</span><span class="o">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Total</span> <span class="mi">7888510</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">2924</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">2986</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">2771</span><span class="p">),</span> <span class="n">pack</span><span class="o">-</span><span class="n">reused</span> <span class="mi">7885231</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">Receiving</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">7888510</span><span class="o">/</span><span class="mi">7888510</span><span class="p">),</span> <span class="mf">24.30</span> <span class="n">GiB</span> <span class="o">|</span> <span class="mf">30.30</span> <span class="n">MiB</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="o">.</span>
<span class="n">Resolving</span> <span class="n">deltas</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">6123467</span><span class="o">/</span><span class="mi">6123467</span><span class="p">),</span> <span class="n">done</span><span class="o">.</span>
<span class="n">Updating</span> <span class="n">files</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">56225</span><span class="o">/</span><span class="mi">56225</span><span class="p">),</span> <span class="n">done</span><span class="o">.</span>
<span class="n">Found</span> <span class="mi">17449</span> <span class="n">markdown</span> <span class="n">files</span><span class="o">.</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-3-markdown">
<h3>Cell 3: å¤„ç† Markdown æ–‡ä»¶<a class="headerlink" href="#cell-3-markdown" title="Link to this heading">#</a></h3>
<p>å°†æ‰€æœ‰markdownæ–‡ä»¶æ‹¼æ¥åˆ—è¡¨æ•°æ®ã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># è¯»å–æ‰€æœ‰ Markdown æ–‡ä»¶ï¼Œå¹¶æ”¶é›†æ–‡æœ¬ï¼ˆå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ¸…æ´—æ­¥éª¤ï¼‰</span>
<span class="n">docs_texts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">md_files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1"># å¯é€‰ï¼šè¿‡æ»¤æ‰å­—ç¬¦æ•°è¾ƒå°‘çš„æ–‡ä»¶ï¼Œåªä½¿ç”¨è¶…è¿‡200å­—ç¬¦çš„æ–‡ä»¶</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">docs_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯»å– </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> æ—¶å‡ºé”™ï¼š</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ä»ä»“åº“ä¸­å…±æ”¶é›†åˆ° </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs_texts</span><span class="p">)</span><span class="si">}</span><span class="s2"> ä¸ªæ–‡æ¡£ã€‚&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ä»ä»“åº“ä¸­å…±æ”¶é›†åˆ° 1621 ä¸ªæ–‡æ¡£ã€‚
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-4-hugging-face">
<h3>Cell 4: ä»å¤„ç†åçš„æ•°æ®åˆ›å»º Hugging Face æ•°æ®é›†<a class="headerlink" href="#cell-4-hugging-face" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span>

<span class="c1"># åˆ›å»ºä¸€ä¸ªåŒ…å«å•ä¸ªå­—æ®µ &quot;text&quot; çš„æ•°æ®é›†</span>
<span class="n">docs_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">docs_texts</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">docs_dataset</span><span class="p">)</span>
</pre></div>
</div>
<p>è¾“å‡ºï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Dataset</span><span class="p">({</span>
    <span class="n">features</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
    <span class="n">num_rows</span><span class="p">:</span> <span class="mi">1621</span>
<span class="p">})</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-5-bert">
<h3>Cell 5: åŠ è½½ bert æ¨¡å‹å’Œåˆ†è¯å™¨ï¼Œå¹¶å¯¹æ•°æ®é›†è¿›è¡Œåˆ†è¯<a class="headerlink" href="#cell-5-bert" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">BertForMaskedLM</span>

<span class="c1"># Define the checkpoint string</span>
<span class="n">CHECKPOINT</span> <span class="o">=</span> <span class="s2">&quot;google-bert/bert-base-uncased&quot;</span>

<span class="c1"># Load tokenizer and model from the checkpoint</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">CHECKPOINT</span><span class="p">,</span> <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">BertForMaskedLM</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">CHECKPOINT</span><span class="p">,</span> <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Define the tokenization function (adjust max_length as needed)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">tokenize_function</span><span class="p">(</span><span class="n">examples</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">examples</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>

<span class="c1"># Assuming docs_dataset is already defined, map the tokenization function</span>
<span class="n">tokenized_docs</span> <span class="o">=</span> <span class="n">docs_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">tokenize_function</span><span class="p">,</span> <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>

</pre></div>
</div>
<p>è¾“å‡ºï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.11/dist-packages/huggingface_hub/utils/_auth.py:94: UserWarning: 
The secret `HF_TOKEN` does not exist in your Colab secrets.
To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.
You will be able to reuse this secret in all of your notebooks.
Please note that authentication is recommended but still optional to access public models or datasets.
  warnings.warn(
tokenizer_config.json:â€‡100%
â€‡48.0/48.0â€‡[00:00&lt;00:00,â€‡5.35kB/s]
config.json:â€‡100%
â€‡570/570â€‡[00:00&lt;00:00,â€‡63.4kB/s]
vocab.txt:â€‡100%
â€‡232k/232kâ€‡[00:00&lt;00:00,â€‡6.17MB/s]
tokenizer.json:â€‡100%
â€‡466k/466kâ€‡[00:00&lt;00:00,â€‡10.4MB/s]
The argument `trust_remote_code` is to be used with Auto classes. It has no effect here and is ignored.
model.safetensors:â€‡100%
â€‡440M/440Mâ€‡[00:02&lt;00:00,â€‡184MB/s]
BertForMaskedLM has generative capabilities, as `prepare_inputs_for_generation` is explicitly overwritten. However, it doesn&#39;t directly inherit from `GenerationMixin`. From ğŸ‘‰v4.50ğŸ‘ˆ onwards, `PreTrainedModel` will NOT inherit from `GenerationMixin`, and this model will lose the ability to call `generate` and other related functions.
  - If you&#39;re using `trust_remote_code=True`, you can get rid of this warning by loading the model with an auto class. See https://huggingface.co/docs/transformers/en/model_doc/auto#auto-classes
  - If you are the owner of the model architecture code, please modify your model class such that it inherits from `GenerationMixin` (after `PreTrainedModel`, otherwise you&#39;ll get an exception).
  - If you are not the owner of the model architecture class, please contact the model code owner to update it.
Some weights of the model checkpoint at google-bert/bert-base-uncased were not used when initializing BertForMaskedLM: [&#39;bert.pooler.dense.bias&#39;, &#39;bert.pooler.dense.weight&#39;, &#39;cls.seq_relationship.bias&#39;, &#39;cls.seq_relationship.weight&#39;]
- This IS expected if you are initializing BertForMaskedLM from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForMaskedLM from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Map:â€‡100%
â€‡1621/1621â€‡[00:02&lt;00:00,â€‡587.88â€‡examples/s]
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-6-mlm">
<h3>Cell 6: å‡†å¤‡ç”¨äº MLM çš„æ•°æ®æ”¶é›†å™¨<a class="headerlink" href="#cell-6-mlm" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataCollatorForLanguageModeling</span>

<span class="c1"># åˆ›å»º MLM æ•°æ®æ”¶é›†å™¨ï¼Œè®¾ç½® 15% çš„ mask æ¦‚ç‡</span>
<span class="n">data_collator</span> <span class="o">=</span> <span class="n">DataCollatorForLanguageModeling</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">mlm_probability</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-7-trainer">
<h3>Cell 7: è®¾ç½®è®­ç»ƒå‚æ•°å¹¶åˆå§‹åŒ– Trainer<a class="headerlink" href="#cell-7-trainer" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Trainer</span><span class="p">,</span> <span class="n">TrainingArguments</span>

<span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./bert-azure-docs-mlm&quot;</span><span class="p">,</span>       <span class="c1"># è¾“å‡ºç›®å½•</span>
    <span class="n">overwrite_output_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">evaluation_strategy</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">,</span>                  <span class="c1"># å¦‚éœ€å®šæœŸè¯„ä¼°ï¼Œå¯æ”¹ä¸º &quot;steps&quot;</span>
    <span class="n">num_train_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>                        <span class="c1"># æ ¹æ®éœ€è¦è°ƒæ•´è®­ç»ƒè½®æ¬¡</span>
    <span class="n">per_device_train_batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>            <span class="c1"># æ ¹æ® GPU å®¹é‡è°ƒæ•´ batch size</span>
    <span class="n">save_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>                            <span class="c1"># æ¯500æ­¥ä¿å­˜ä¸€æ¬¡æ¨¡å‹</span>
    <span class="n">save_total_limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>                        <span class="c1"># æœ€å¤šä¿å­˜æœ€è¿‘2ä¸ª checkpoint</span>
<span class="p">)</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
    <span class="n">data_collator</span><span class="o">=</span><span class="n">data_collator</span><span class="p">,</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">tokenized_docs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-8-mlm">
<h3>Cell 8: ä½¿ç”¨ MLM ç›®æ ‡å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒ<a class="headerlink" href="#cell-8-mlm" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># å¯¹å¤„ç†åçš„ Azure æ–‡æ¡£æ•°æ®è¿›è¡Œ MLM å¾®è°ƒ</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
<blockquote>
<div><p>éœ€è¦wandb.aiçš„key</p>
</div></blockquote>
<p><img alt="wandb-key" src="../_images/wandb-key.png" /></p>
<p>è¾“å‡ºï¼š</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>wandb: WARNING The <span class="sb">`run_name`</span> is currently set to the same value as <span class="sb">`TrainingArguments.output_dir`</span>. If this was not intended, please specify a different run name by setting the <span class="sb">`TrainingArguments.run_name`</span> parameter.
wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
wandb: Logging into wandb.ai. (Learn how to deploy a W&amp;B server locally: https://wandb.me/wandb-server)
wandb: You can find your API key in your browser here: https://wandb.ai/authorize
wandb: Paste an API key from your profile and hit enter: Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
wandb: WARNING If you&#39;re specifying your api key in code, ensure this code is not shared publicly.
wandb: WARNING Consider setting the WANDB_API_KEY environment variable, or running <span class="sb">`wandb login`</span> from the command line.
wandb: No netrc file found, creating one.
wandb: Appending key for api.wandb.ai to your netrc file: /root/.netrc
wandb: Currently logged in as: galty687 (galty687-peking-university) to https://api.wandb.ai. Use <span class="sb">`wandb login --relogin`</span> to force relogin
Tracking run with wandb version 0.19.8
Run data is saved locally in /content/wandb/run-20250319_085505-fwlzb07r
Syncing run ./phi4-azure-docs-mlm to Weights &amp; Biases (docs)
View project at https://wandb.ai/galty687-peking-university/huggingface
View run at https://wandb.ai/galty687-peking-university/huggingface/runs/fwlzb07r
 [306/306 00:35, Epoch 3/3]
Step	Training Loss
TrainOutput(global_step=306, training_loss=1.0518618315653083, metrics={&#39;train_runtime&#39;: 61.0276, &#39;train_samples_per_second&#39;: 79.685, &#39;train_steps_per_second&#39;: 5.014, &#39;total_flos&#39;: 319991251161600.0, &#39;train_loss&#39;: 1.0518618315653083, &#39;epoch&#39;: 3.0})
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cell-9">
<h3>Cell 9: ä¿å­˜å¾®è°ƒåçš„æ¨¡å‹å’Œåˆ†è¯å™¨<a class="headerlink" href="#cell-9" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">google.colab</span><span class="w"> </span><span class="kn">import</span> <span class="n">drive</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># æŒ‚è½½ Google Drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>

<span class="c1"># å®šä¹‰ä¿å­˜æ¨¡å‹å’Œåˆ†è¯å™¨çš„ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆfine-tuned-models æ–‡ä»¶å¤¹ä¸­ï¼‰</span>
<span class="n">dest_folder</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/fine-tuned-models/bert-azure-docs-mlm&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ä¿å­˜å¾®è°ƒåçš„æ¨¡å‹å’Œåˆ†è¯å™¨åˆ°ç›®æ ‡è·¯å¾„</span>
<span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">)</span>
<span class="n">tokenizer</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æ¨¡å‹å’Œåˆ†è¯å™¨å·²ä¿å­˜åˆ° </span><span class="si">{</span><span class="n">dest_folder</span><span class="si">}</span><span class="s2"> æ–‡ä»¶å¤¹ä¸­ã€‚&quot;</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p>è¾“å‡ºï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
æ¨¡å‹å’Œåˆ†è¯å™¨å·²ä¿å­˜åˆ° /content/drive/MyDrive/fine-tuned-models/bert-azure-docs-mlm æ–‡ä»¶å¤¹ä¸­ã€‚
</pre></div>
</div>
<p><img alt="stored-model" src="../_images/stored-model.png" /></p>
<p>ä»¥ä¸Šä»£ç åˆ†ä¸ºå¤šä¸ªå•å…ƒæ ¼ï¼Œä½ å¯ä»¥åœ¨ Google Colab ä¸­ä¾æ¬¡è¿è¡Œã€‚ä½ å¯ä»¥æ ¹æ®å®é™…æ•°æ®å’Œ GPU èµ„æºï¼Œè°ƒæ•´ <code class="docutils literal notranslate"><span class="pre">max_length</span></code>ã€<code class="docutils literal notranslate"><span class="pre">num_train_epochs</span></code>ã€batch size ç­‰å‚æ•°ã€‚æ­¤æµç¨‹å…ˆåˆ©ç”¨ MLM ç›®æ ‡å¾®è°ƒæ¨¡å‹ï¼Œå†åç»­å¯ä»¥æ ¹æ®éœ€è¦ç”¨å¸¦æœ‰ä¸åŒé£æ ¼çš„ SFT æ•°æ®è¿›ä¸€æ­¥è¿›è¡Œå¾®è°ƒã€‚</p>
<hr class="docutils" />
<p>å®éªŒè¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™å› ä¸ºå„ç§åŸå› ä¼šé‡å¯sessionï¼Œå¯ä»¥è®²å¾®è°ƒæ•°æ®å­˜å…¥Google Driveï¼ŒèŠ‚çº¦é‡å¤ä¸‹è½½çš„æ—¶é—´ã€‚</p>
</section>
<section id="id3">
<h3>å‡†å¤‡æ•°æ®<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>å°†æ‰€æœ‰markdownæ–‡ä»¶è¯»å–åï¼Œæ‹¼æ¥ä¸ºä¸€ä¸ªå•ç‹¬çš„ <code class="docutils literal notranslate"><span class="pre">docs_texts</span></code>åˆ—è¡¨ã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">google.colab</span><span class="w"> </span><span class="kn">import</span> <span class="n">drive</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">glob</span>

<span class="c1"># æŒ‚è½½ Google Drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>

<span class="c1"># å®šä¹‰ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„</span>
<span class="n">dest_folder</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/pure-md-files&#39;</span>

<span class="c1"># ä½¿ç”¨ glob è·å–ç›®æ ‡æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰ Markdown æ–‡ä»¶ï¼ˆæ ¹ç›®å½•ä¸‹çš„ï¼‰</span>
<span class="n">md_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="s1">&#39;*.md&#39;</span><span class="p">))</span>
<span class="n">docs_texts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">md_files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1"># è¿‡æ»¤æ‰å­—ç¬¦æ•°è¾ƒå°‘çš„æ–‡ä»¶ï¼Œåªä½¿ç”¨è¶…è¿‡200å­—ç¬¦çš„æ–‡ä»¶</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">docs_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¯»å– </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> æ—¶å‡ºé”™ï¼š</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ä»ä»“åº“ä¸­å…±æ”¶é›†åˆ° </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs_texts</span><span class="p">)</span><span class="si">}</span><span class="s2"> ä¸ªæ–‡æ¡£ã€‚&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="jsongoogle-drive">
<h3>å°†æ•°æ®è½¬ä¸ºjsonå­˜å…¥Google Drive<a class="headerlink" href="#jsongoogle-drive" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="c1"># å®šä¹‰ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå·²æŒ‚è½½åˆ° Google Driveï¼‰</span>
<span class="n">dest_folder</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/pure-md-files&#39;</span>

<span class="c1"># æ„é€ ä¿å­˜æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="s1">&#39;docs_texts.json&#39;</span><span class="p">)</span>

<span class="c1"># ä¿å­˜ docs_texts åˆ°ç›®æ ‡è·¯å¾„ä¸­çš„ JSON æ–‡ä»¶</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">docs_texts</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;docs_texts å·²ä¿å­˜åˆ° </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> æ–‡ä»¶ã€‚&quot;</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="json-docs-texts">
<h3>ä»ç›®æ ‡è·¯å¾„ä¸­çš„ JSON æ–‡ä»¶ä¸­åŠ è½½ docs_texts<a class="headerlink" href="#json-docs-texts" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">google.colab</span><span class="w"> </span><span class="kn">import</span> <span class="n">drive</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="c1"># æŒ‚è½½ Google Drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>

<span class="c1"># å®šä¹‰ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå·²æŒ‚è½½åˆ° Google Driveï¼‰</span>
<span class="n">dest_folder</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/pure-md-files&#39;</span>
<span class="c1"># æ„é€ æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span>
<span class="n">load_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="s1">&#39;docs_texts.json&#39;</span><span class="p">)</span>

<span class="c1"># ä»ç›®æ ‡è·¯å¾„ä¸­çš„ JSON æ–‡ä»¶ä¸­åŠ è½½ docs_texts</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">load_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">docs_texts</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;docs_texts å·²ä» </span><span class="si">{</span><span class="n">load_path</span><span class="si">}</span><span class="s2"> æ–‡ä»¶ä¸­åŠ è½½ã€‚&quot;</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="nsp">
<h2>ä¸‹ä¸€å¥é¢„æµ‹ï¼ˆNSPï¼‰<a class="headerlink" href="#nsp" title="Link to this heading">#</a></h2>
<p>å¯¹äº NSP ä»»åŠ¡ï¼Œéœ€è¦åœ¨æ•°æ®é¢„å¤„ç†é˜¶æ®µæ„é€ å¥å­å¯¹ï¼Œå¹¶ä¸ºæ¯å¯¹å¥å­æŒ‡å®šæ ‡ç­¾ï¼ˆå³ç¬¬äºŒä¸ªå¥å­æ˜¯å¦ä¸ºç¬¬ä¸€ä¸ªå¥å­çš„åç»­å¥ï¼‰ã€‚è¿™é€šå¸¸éœ€è¦è‡ªå®šä¹‰æ•°æ®é›†ï¼Œå¹¶åœ¨æ¨¡å‹å®šä¹‰æ—¶é€‰æ‹©æ”¯æŒ NSP ä»»åŠ¡çš„æ¨¡å‹æ¶æ„ï¼Œä¾‹å¦‚ <code class="docutils literal notranslate"><span class="pre">BertForPreTraining</span></code>ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€è¦çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BertForPreTraining</span><span class="p">,</span> <span class="n">Trainer</span><span class="p">,</span> <span class="n">TrainingArguments</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">BertForPreTraining</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-uncased&quot;</span><span class="p">)</span>

<span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./bert-finetuned&quot;</span><span class="p">,</span>
    <span class="n">per_device_train_batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">num_train_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">save_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">save_total_limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">custom_nsp_dataset</span><span class="p">,</span>  <span class="c1"># è‡ªå®šä¹‰çš„ NSP æ•°æ®é›†</span>
<span class="p">)</span>

</pre></div>
</div>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code class="docutils literal notranslate"><span class="pre">custom_nsp_dataset</span></code> æ˜¯ä¸€ä¸ªåŒ…å«å¥å­å¯¹å’Œå¯¹åº”æ ‡ç­¾çš„æ•°æ®é›†ï¼Œ<code class="docutils literal notranslate"><span class="pre">BertForPreTraining</span></code> æ¨¡å‹åŒæ—¶æ”¯æŒ MLM å’Œ NSP ä»»åŠ¡ã€‚</p>
</section>
<section id="id4">
<h2>å‚è€ƒèµ„æ–™<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://huggingface.co/learn/nlp-course/en/chapter7/3">Fine-tuning a masked language model</a></p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ft-rep-models.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">ä¸Šä¸€é¡µ</p>
        <p class="prev-next-title">å¾®è°ƒè¡¨ç¤ºå‹å¤§æ¨¡å‹</p>
      </div>
    </a>
    <a class="right-next"
       href="ft-ph4-self.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">ä¸‹ä¸€é¡µ</p>
        <p class="prev-next-title">ç»ƒä¹ ï¼šä½¿ç”¨è‡ªç›‘ç£å­¦ä¹ å¾®è°ƒPhi4-mini</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> ç›®å½•
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#masked-language-model-mlm">æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked Language Modelï¼ŒMLMï¼‰</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">ç¤ºä¾‹æ•°æ®</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">ç¤ºä¾‹ä»£ç </a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bert-mlm">ä½¿ç”¨å¾®è½¯æ–‡æ¡£æ–‡æœ¬å¾®è°ƒBert (MLM)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-1">Cell 1: å®‰è£…ä¾èµ–</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-2-microsoftdocs-azure-docs">Cell 2: å…‹éš† MicrosoftDocs/azure-docs ä»“åº“</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-3-markdown">Cell 3: å¤„ç† Markdown æ–‡ä»¶</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-4-hugging-face">Cell 4: ä»å¤„ç†åçš„æ•°æ®åˆ›å»º Hugging Face æ•°æ®é›†</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-5-bert">Cell 5: åŠ è½½ bert æ¨¡å‹å’Œåˆ†è¯å™¨ï¼Œå¹¶å¯¹æ•°æ®é›†è¿›è¡Œåˆ†è¯</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-6-mlm">Cell 6: å‡†å¤‡ç”¨äº MLM çš„æ•°æ®æ”¶é›†å™¨</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-7-trainer">Cell 7: è®¾ç½®è®­ç»ƒå‚æ•°å¹¶åˆå§‹åŒ– Trainer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-8-mlm">Cell 8: ä½¿ç”¨ MLM ç›®æ ‡å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒ</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-9">Cell 9: ä¿å­˜å¾®è°ƒåçš„æ¨¡å‹å’Œåˆ†è¯å™¨</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">å‡†å¤‡æ•°æ®</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jsongoogle-drive">å°†æ•°æ®è½¬ä¸ºjsonå­˜å…¥Google Drive</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#json-docs-texts">ä»ç›®æ ‡è·¯å¾„ä¸­çš„ JSON æ–‡ä»¶ä¸­åŠ è½½ docs_texts</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nsp">ä¸‹ä¸€å¥é¢„æµ‹ï¼ˆNSPï¼‰</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">å‚è€ƒèµ„æ–™</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
ä½œè€…ï¼š é«˜å¿—å†›
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright Zhijun Gao.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>